{% extends "admin/core/base.html" %}
{% block content %}

<div class="p-6 max-w-4xl mx-auto bg-white rounded-xl shadow-md font-[calibri]">

  <!-- Heading -->
  <h2 class="text-2xl font-semibold text-gray-800 mb-2">📦 Available Backups</h2>
  <p class="text-sm text-gray-600 mb-6">
    Clicking “Create &amp; Download Backup” will generate a fresh JSON dump and download it directly to your computer.
    Existing files listed below are older server-side backups (from before this change). You can also upload a local
    <code>.json</code> backup from your computer to restore immediately.
  </p>

  <!-- Create Backup + Upload & Restore -->
  <div class="mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:gap-6">

    <!-- Create Backup Form (POST => immediate download via FileResponse) -->
    <form method="post" class="inline-block">
      {% csrf_token %}
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition">
        📦 Create &amp; Download Backup
      </button>
    </form>

    <!-- Upload & Restore (NEW) -->
    <form action="{% url 'upload_restore_backup' %}" method="post" enctype="multipart/form-data" class="inline-flex items-center gap-2">
      {% csrf_token %}
      <label class="text-sm text-gray-700">Upload .json backup:</label>
      <input type="file" name="backup_file" accept=".json" class="border px-2 py-1 rounded text-sm">
      <button type="submit"
              class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded text-sm">
        ⤴ Restore from File
      </button>
    </form>

  </div>

  <!-- Backup File List (legacy files that still live on the server) -->
  <div>
    {% if backup_files %}
      <ul class="space-y-4">
        {% for file in backup_files %}
          <li class="border border-gray-200 p-4 rounded-md flex justify-between items-center">
            <span class="text-sm font-mono text-gray-700">{{ file }}</span>
            <div class="space-x-2">
              <a href="{% url 'download_backup' file %}" class="text-blue-600 hover:underline text-sm">⬇ Download</a>

              <form action="{% url 'restore_backup' file %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit"
                        onclick="return confirm('Are you sure you want to restore this backup? This will overwrite current data.')"
                        class="text-green-600 hover:underline text-sm">
                  ♻ Restore
                </button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-gray-500 text-sm italic">No backup files found on server.</p>
    {% endif %}
  </div>

</div>

{% endblock %}